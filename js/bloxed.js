!function(){"use strict";function a(){var b,c,d,e,f;c=new PIXI.Text("Bloxed",{font:"bold "+Math.floor(h.width/10)+"px Verdana",fill:"#415df7",align:"center",stroke:"#f7ae0b",strokeThickness:35}),c.anchor.x=.5,c.anchor.y=.5,c.position.x=h.width/2,c.position.y=c.height/1.5,d=new PIXI.Text("How to play:\nPush some blocks about and collect the keys!\nMove around by pressing Z, X, P and L... or just use the cursor Keys.\nPress R or Escape to Restart the Level.",{font:"bold "+Math.floor(h.width/40)+"px Verdana",fill:"#082cf0",align:"center",stroke:"#f7ae0b",strokeThickness:6}),d.anchor.x=.5,d.anchor.y=.5,d.position.x=h.width/2,d.position.y=c.height+d.height/1.2,e=new PIXI.Text("Press ENTER to Start",{font:"bold "+Math.floor(h.width/20)+"px Verdana",fill:"#ff2700",align:"center",stroke:"#f7ae0b",strokeThickness:6}),e.anchor.x=.5,e.anchor.y=.5,e.position.x=h.width/2,e.position.y=h.height/1.4,f=new PIXI.Text("(c)2015 Kev Ellis - Released under the MIT Open Source Licence",{font:"bold "+Math.floor(h.width/40)+"px Verdana",fill:"#a5a4a3",align:"center",stroke:"#4d4940",strokeThickness:6}),f.anchor.x=.5,f.anchor.y=.5,f.position.x=h.width/2,f.position.y=h.height-f.height,a.prototype.init=function(){for(;g.children[0];)g.removeChild(g.children[0]);g.addChild(c),g.addChild(d),g.addChild(e),g.addChild(f),b=!0,u=1},a.prototype.animate=function(a){r===!0&&(r=!1,j.init(1),t=1),b===!0?(e.scale.x+=2e-4*a,e.scale.y=e.scale.x,e.scale.x>1.05&&(b=!1)):(e.scale.x-=2e-4*a,e.scale.y=e.scale.x,e.scale.x<1&&(b=!0))}}function b(){b.prototype.getTexture=function(b){return a[b]};var a=[];a.push(PIXI.Texture.fromImage("images/crate.png")),a.push(PIXI.Texture.fromImage("images/edge.png")),a.push(PIXI.Texture.fromImage("images/static1.png")),a.push(PIXI.Texture.fromImage("images/static2.png")),a.push(PIXI.Texture.fromImage("images/left.png")),a.push(PIXI.Texture.fromImage("images/right.png")),a.push(PIXI.Texture.fromImage("images/up.png")),a.push(PIXI.Texture.fromImage("images/down.png")),a.push(PIXI.Texture.fromImage("images/key.png"))}function c(){var a,b,d,e=[],f=[],m=20,n=12,o=[],p=0,q=.8;d=new PIXI.Text("Level Complete!",{font:"bold "+Math.floor(h.width/20)+"px Verdana",fill:"#ff2700",align:"center",stroke:"#f7ae0b",strokeThickness:6}),d.anchor.x=.5,d.anchor.y=.5,d.position.x=h.width/2,d.position.y=h.height/2,b=new PIXI.Text("Congratulations!\nYou've Completed\nAll of the Levels",{font:"bold "+Math.floor(h.width/30)+"px Verdana",fill:"#f8ea79",align:"center",stroke:"#f7ae0b",strokeThickness:6}),b.anchor.x=.5,b.anchor.y=.5,b.position.x=h.width/2,b.position.y=h.height/2,c.prototype.init=function(c){for(var d,h,j=0,l=0;g.children[0];)g.removeChild(g.children[0]);if(c>levels.length)return t=3,void g.addChild(b);for(e=levels[c-1].slice(),a=0,j=0;j<n*m;j+=1)9!==e[j]&&(o[l]=new PIXI.Sprite(i.getTexture(e[j])),o[l].x=64*(j%m+1)-32,o[l].y=32+64*Math.floor(j/m),o[l].gridX=j%m,o[l].gridY=Math.floor(j/m),o[l].anchor.x=.5,o[l].anchor.y=.5,o[l].tileType=e[j],g.addChild(o[l]),10===e[j]&&(d=o[l].gridX+1,h=o[l].gridY+1,e[j]=9),f[j]=l,l+=1,8===e[j]&&(a+=1));k.initPlayer(d,h)},c.prototype.moveTile=function(a,b,c,d,g,h){var i,j;switch(i=f[a-1+(b-1)*m],j=a-1+(b-1)*m,g){case 0:h===!0?o[i].x-=c*d:(e[j]=9,e[j-1]=0,f[j-1]=i,o[i].x=64*(a-1)-32);break;case 1:h===!0?o[i].x+=c*d:(e[j]=9,e[j+1]=0,f[j+1]=i,o[i].x=64*(a+1)-32);break;case 2:h===!0?o[i].y-=c*d:(e[j]=9,e[j-m]=0,f[j-m]=i,o[i].y=64*(b-1)-32);break;case 3:h===!0?o[i].y+=c*d:(e[j]=9,e[j+m]=0,f[j+m]=i,o[i].y=64*(b+1)-32)}},c.prototype.getTile=function(a,b){return e[a-1+(b-1)*m]},c.prototype.animate=function(a){var b=0;for(0===p?(q-=3e-4*a,q<.7&&(p=1)):(q+=3e-4*a,q>.9&&(p=0)),b=0;b<o.length;b+=1)8===o[b].tileType&&(o[b].scale.x=q,o[b].scale.y=q)},c.prototype.gotKey=function(b,c){var h=b-1+(c-1)*m,i=f[h];a-=1,e[h]=9,o[i].visible=!1,0===a&&(d.scale.x=1,d.scale.x=1,t=2,g.addChild(d))},c.prototype.complete=function(a){d.scale.x+=4e-4*a,d.scale.y=d.scale.x,d.scale.x>3&&(u+=1,t=1,j.init(u))},c.prototype.allComplete=function(a){b.scale.x+=1e-4*a,b.scale.y=b.scale.x,b.scale.x>3&&(t=0,b.scale.x=1,b.scale.y=1,l.init())}}function d(){function a(a,b){j.moveTile(h,i,b,f,e,a),a===!1&&(h=99)}var b,c=!1,e=0,f=.08,h=99,i=99,k=new PIXI.Sprite(PIXI.Texture.fromImage("images/truck.png"));k.anchor.x=.5,k.anchor.y=.5,d.prototype.initPlayer=function(a,b){c=!1,h=99,i=99,e=2,k.gridX=a,k.gridY=b,k.x=64*k.gridX-32,k.y=64*k.gridY-32,g.addChild(k)},d.prototype.getPos=function(a){return{x:k.gridX,y:k.gridY}},d.prototype.move=function(d){if(c===!0){switch(e){case 0:k.x-=d*f,k.x<64*(k.gridX-1)-32&&(k.gridX-=1,k.x=64*k.gridX-32,c=!1);break;case 1:k.x+=d*f,k.x>64*(k.gridX+1)-32&&(k.gridX+=1,k.x=64*k.gridX-32,c=!1);break;case 2:k.y-=d*f,k.y<64*(k.gridY-1)-32&&(k.gridY-=1,k.y=64*k.gridY-32,c=!1);break;case 3:k.y+=d*f,k.y>64*(k.gridY+1)-32&&(k.gridY+=1,k.y=64*k.gridY-32,c=!1)}99!==h&&a(c,d)}else m===!0&&(b=j.getTile(k.gridX-1,k.gridY),9!==b&&0!==b&&4!==b&&8!==b||(e=0,c=!0,0===b&&(9===j.getTile(k.gridX-2,k.gridY)?(h=k.gridX-1,i=k.gridY):c=!1),8===b&&j.gotKey(k.gridX-1,k.gridY))),n===!0&&(b=j.getTile(k.gridX+1,k.gridY),9!==b&&0!==b&&5!==b&&8!==b||(e=1,c=!0,0===b&&(9===j.getTile(k.gridX+2,k.gridY)?(h=k.gridX+1,i=k.gridY):c=!1),8===b&&j.gotKey(k.gridX+1,k.gridY))),o===!0&&(b=j.getTile(k.gridX,k.gridY-1),9!==b&&0!==b&&6!==b&&8!==b||(e=2,c=!0,0===b&&(9===j.getTile(k.gridX,k.gridY-2)?(h=k.gridX,i=k.gridY-1):c=!1),8===b&&j.gotKey(k.gridX,k.gridY-1))),p===!0&&(b=j.getTile(k.gridX,k.gridY+1),9!==b&&0!==b&&7!==b&&8!==b||(e=3,c=!0,0===b&&(9===j.getTile(k.gridX,k.gridY+2)?(h=k.gridX,i=k.gridY+1):c=!1),8===b&&j.gotKey(k.gridX,k.gridY+1)));switch(e){case 0:k.rotation=4.7123889804;break;case 1:k.rotation=1.5707963268;break;case 2:k.rotation=0;break;case 3:k.rotation=3.1415926536}}}function e(){var a,b;return a=(new Date).getTime(),b=a-(s||a),s=a,b<200?b:200}function f(){var a;switch(window.requestAnimationFrame(f),a=e(),t){case 0:l.animate(a);break;case 1:k.move(a),j.animate(a);break;case 2:k.move(a),j.complete(a);break;case 3:j.allComplete(a)}h.render(g)}var g,h,i,j,k,l,m,n,o,p,q,r,s,t=0,u=1;g=new PIXI.Container,h=PIXI.autoDetectRenderer(1280,768),h.view.style.position="absolute",window.innerWidth>window.innerHeight?(h.view.style.width=Math.floor(1.666666667*window.innerHeight)+"px",h.view.style.height=Math.floor(window.innerHeight)+"px"):(h.view.style.width=Math.floor(window.innerWidth)+"px",h.view.style.height=Math.floor(.6*window.innerWidth)+"px"),h.view.style.display="block",h.view.style.left=Math.floor((window.innerWidth-parseInt(h.view.style.width,10))/2)+"px",document.body.appendChild(h.view),window.addEventListener("keydown",function(a){switch(a.keyCode){case 90:case 37:m=!0;break;case 88:case 39:n=!0;break;case 80:case 38:o=!0;break;case 76:case 40:p=!0;break;case 13:r=!0;break;case 82:case 27:1===t&&j.init(u);break;case 46:q=!0;break;case 67:q===!0&&1===t&&(u+=1,j.init(u))}},!1),window.addEventListener("keyup",function(a){switch(a.keyCode){case 90:case 37:m=!1;break;case 88:case 39:n=!1;break;case 80:case 38:o=!1;break;case 76:case 40:p=!1;break;case 46:q=!0}},!1),i=new b,l=new a,j=new c,k=new d,l.init(),window.requestAnimationFrame(f)}();